# 機能追加仕様（Markdown版）

## 1. memberApi（`src/lib/memberApi.ts`）

### ● 追加関数：`checkMemberReferenced(memberId)`
会員が他テーブルで参照されているかを確認する。

#### 処理内容
- `announcements` テーブルの `author_id` に該当会員 ID が含まれるか検索  
- 結果が 1 件以上の場合  
  ```ts
  { referenced: true, message: 'お知らせの作成者として参照されています。削除できません。' }
  ```
- 0 件の場合  
  ```ts
  { referenced: false }
  ```

### ● 追加型：`MemberReferenceCheckResult`
- `referenced: boolean`
- `message?: string`

---

## 2. エキストラ管理ページ（`src/app/admin/extra/page.tsx`）

### ● 不要会員の物理削除セクション

---

### 2.1 一覧表示
- マウント時に `fetchMembers()` を実行し、会員一覧を取得  
- 表示項目  
  - 会員番号  
  - 氏名  
  - ニックネーム  
  - ID（先頭8文字）  
  - 「削除」ボタン  

---もちろん、智規。  
いただいたテキストを、**そのまま specs やタスク仕様書に貼れるレベルの Markdown** に整形したよ。  
構造化・階層化して、Cursor が理解しやすい形にしてある。

---

# 機能追加仕様（Markdown版）

## 1. memberApi（`src/lib/memberApi.ts`）

### ● 追加関数：`checkMemberReferenced(memberId)`
会員が他テーブルで参照されているかを確認する。

#### 処理内容
- `announcements` テーブルの `author_id` に該当会員 ID が含まれるか検索  
- 結果が 1 件以上の場合  
  ```ts
  { referenced: true, message: 'お知らせの作成者として参照されています。削除できません。' }
  ```
- 0 件の場合  
  ```ts
  { referenced: false }
  ```

### ● 追加型：`MemberReferenceCheckResult`
- `referenced: boolean`
- `message?: string`

---

## 2. エキストラ管理ページ（`src/app/admin/extra/page.tsx`）

### ● 不要会員の物理削除セクション

---

### 2.1 一覧表示
- マウント時に `fetchMembers()` を実行し、会員一覧を取得  
- 表示項目  
  - 会員番号  
  - 氏名  
  - ニックネーム  
  - ID（先頭8文字）  
  - 「削除」ボタン  

---

### 2.2 削除フロー

#### ① 削除ボタンクリック
- `window.confirm` で確認ダイアログを表示  
  ```
  会員ID xxx（会員番号 氏名（ニックネーム））を物理削除します。よろしいですか？
  ```
- キャンセル → 何もしない  
- OK → `checkMemberReferenced(memberId)` を実行  

#### ② 参照チェック
- `referenced: true`  
  - 「お知らせの作成者として参照されています。削除できません。」を画面に表示  
  - 削除しない  
- `referenced: false`  
  - `deleteMember(member.id)` を実行し、members から物理削除  

#### ③ 削除成功後
- `loadMembers()` を再実行し、一覧を更新  

#### ④ エラーハンドリング
- 参照チェックや削除でエラーが発生した場合  
  - エラーメッセージを画面上に表示  

---

### 2.3 データ構造
- `members` の構造は  
  `docs/specs/members/db_members_scheme.md` に準拠  
- 参照チェックは  
  `docs/specs/announcements/db_announcements_scheme.md` の `author_id` のみ使用  

---

## 3. テスト

### ● `admin/extra/page.test.tsx`
- `memberApi` をモック  
- `fetchMembers` が呼ばれること  
- 0 件時に「会員が0件です」と表示されること  
- 2 セクションの存在確認  
- 戻るリンクの存在確認  

---

### ● `memberApi.test.ts`
- `checkMemberReferenced` のテストを追加  
- `announcements` に `author_id` が無い場合 → `referenced: false`  
- `author_id` がある場合 →  
  - `referenced: true`  
  - メッセージが「お知らせの作成者として参照されています」  

---

## 4. 今後の拡張

### ● 他テーブル参照の追加
会員 ID を参照するテーブルが増えた場合は、  
`checkMemberReferenced` 内に以下のようなチェックを追加する：

```ts
supabase
  .from('テーブル名')
  .select()
  .eq('会員IDカラム', memberId)
  .limit(1)
```

- 1 件以上あれば  
  ```ts
  { referenced: true, message: '◯◯で参照されています。削除できません。' }
  ```
- これを積み重ねることで、参照整合性を担保できる  

---

必要なら、この仕様を **docs/specs/admin/extra/delete_members.md** のようなファイルに分離する形で整形し直すこともできるよ。もちろん、智規。  
いただいたテキストを、**そのまま specs やタスク仕様書に貼れるレベルの Markdown** に整形したよ。  
構造化・階層化して、Cursor が理解しやすい形にしてある。

---

# 機能追加仕様（Markdown版）

## 1. memberApi（`src/lib/memberApi.ts`）

### ● 追加関数：`checkMemberReferenced(memberId)`
会員が他テーブルで参照されているかを確認する。

#### 処理内容
- `announcements` テーブルの `author_id` に該当会員 ID が含まれるか検索  
- 結果が 1 件以上の場合  
  ```ts
  { referenced: true, message: 'お知らせの作成者として参照されています。削除できません。' }
  ```
- 0 件の場合  
  ```ts
  { referenced: false }
  ```

### ● 追加型：`MemberReferenceCheckResult`
- `referenced: boolean`
- `message?: string`

---

## 2. エキストラ管理ページ（`src/app/admin/extra/page.tsx`）

### ● 不要会員の物理削除セクション

---

### 2.1 一覧表示
- マウント時に `fetchMembers()` を実行し、会員一覧を取得  
- 表示項目  
  - 会員番号  
  - 氏名  
  - ニックネーム  
  - ID（先頭8文字）  
  - 「削除」ボタン  

---

### 2.2 削除フロー

#### ① 削除ボタンクリック
- `window.confirm` で確認ダイアログを表示  
  ```
  会員ID xxx（会員番号 氏名（ニックネーム））を物理削除します。よろしいですか？
  ```
- キャンセル → 何もしない  
- OK → `checkMemberReferenced(memberId)` を実行  

#### ② 参照チェック
- `referenced: true`  
  - 「お知らせの作成者として参照されています。削除できません。」を画面に表示  
  - 削除しない  
- `referenced: false`  
  - `deleteMember(member.id)` を実行し、members から物理削除  

#### ③ 削除成功後
- `loadMembers()` を再実行し、一覧を更新  

#### ④ エラーハンドリング
- 参照チェックや削除でエラーが発生した場合  
  - エラーメッセージを画面上に表示  

---

### 2.3 データ構造
- `members` の構造は  
  `docs/specs/members/db_members_scheme.md` に準拠  
- 参照チェックは  
  `docs/specs/announcements/db_announcements_scheme.md` の `author_id` のみ使用  

---

## 3. テスト

### ● `admin/extra/page.test.tsx`
- `memberApi` をモック  
- `fetchMembers` が呼ばれること  
- 0 件時に「会員が0件です」と表示されること  
- 2 セクションの存在確認  
- 戻るリンクの存在確認  

---

### ● `memberApi.test.ts`
- `checkMemberReferenced` のテストを追加  
- `announcements` に `author_id` が無い場合 → `referenced: false`  
- `author_id` がある場合 →  
  - `referenced: true`  
  - メッセージが「お知らせの作成者として参照されています」  

---

## 4. 今後の拡張

### ● 他テーブル参照の追加
会員 ID を参照するテーブルが増えた場合は、  
`checkMemberReferenced` 内に以下のようなチェックを追加する：

```ts
supabase
  .from('テーブル名')
  .select()
  .eq('会員IDカラム', memberId)
  .limit(1)
```

- 1 件以上あれば  
  ```ts
  { referenced: true, message: '◯◯で参照されています。削除できません。' }
  ```
- これを積み重ねることで、参照整合性を担保できる  

---

必要なら、この仕様を **docs/specs/admin/extra/delete_members.md** のようなファイルに分離する形で整形し直すこともできるよ。もちろん、智規。  
いただいたテキストを、**そのまま specs やタスク仕様書に貼れるレベルの Markdown** に整形したよ。  
構造化・階層化して、Cursor が理解しやすい形にしてある。

---

# 機能追加仕様（Markdown版）

## 1. memberApi（`src/lib/memberApi.ts`）

### ● 追加関数：`checkMemberReferenced(memberId)`
会員が他テーブルで参照されているかを確認する。

#### 処理内容
- `announcements` テーブルの `author_id` に該当会員 ID が含まれるか検索  
- 結果が 1 件以上の場合  
  ```ts
  { referenced: true, message: 'お知らせの作成者として参照されています。削除できません。' }
  ```
- 0 件の場合  
  ```ts
  { referenced: false }
  ```

### ● 追加型：`MemberReferenceCheckResult`
- `referenced: boolean`
- `message?: string`

---

## 2. エキストラ管理ページ（`src/app/admin/extra/page.tsx`）

### ● 不要会員の物理削除セクション

---

### 2.1 一覧表示
- マウント時に `fetchMembers()` を実行し、会員一覧を取得  
- 表示項目  
  - 会員番号  
  - 氏名  
  - ニックネーム  
  - ID（先頭8文字）  
  - 「削除」ボタン  

---

### 2.2 削除フロー

#### ① 削除ボタンクリック
- `window.confirm` で確認ダイアログを表示  
  ```
  会員ID xxx（会員番号 氏名（ニックネーム））を物理削除します。よろしいですか？
  ```
- キャンセル → 何もしない  
- OK → `checkMemberReferenced(memberId)` を実行  

#### ② 参照チェック
- `referenced: true`  
  - 「お知らせの作成者として参照されています。削除できません。」を画面に表示  
  - 削除しない  
- `referenced: false`  
  - `deleteMember(member.id)` を実行し、members から物理削除  

#### ③ 削除成功後
- `loadMembers()` を再実行し、一覧を更新  

#### ④ エラーハンドリング
- 参照チェックや削除でエラーが発生した場合  
  - エラーメッセージを画面上に表示  

---

### 2.3 データ構造
- `members` の構造は  
  `docs/specs/members/db_members_scheme.md` に準拠  
- 参照チェックは  
  `docs/specs/announcements/db_announcements_scheme.md` の `author_id` のみ使用  

---

## 3. テスト

### ● `admin/extra/page.test.tsx`
- `memberApi` をモック  
- `fetchMembers` が呼ばれること  
- 0 件時に「会員が0件です」と表示されること  
- 2 セクションの存在確認  
- 戻るリンクの存在確認  

---

### ● `memberApi.test.ts`
- `checkMemberReferenced` のテストを追加  
- `announcements` に `author_id` が無い場合 → `referenced: false`  
- `author_id` がある場合 →  
  - `referenced: true`  
  - メッセージが「お知らせの作成者として参照されています」  

---

## 4. 今後の拡張

### ● 他テーブル参照の追加
会員 ID を参照するテーブルが増えた場合は、  
`checkMemberReferenced` 内に以下のようなチェックを追加する：

```ts
supabase
  .from('テーブル名')
  .select()
  .eq('会員IDカラム', memberId)
  .limit(1)
```

- 1 件以上あれば  
  ```ts
  { referenced: true, message: '◯◯で参照されています。削除できません。' }
  ```
- これを積み重ねることで、参照整合性を担保できる  

---

必要なら、この仕様を **docs/specs/admin/extra/delete_members.md** のようなファイルに分離する形で整形し直すこともできるよ。

### 2.2 削除フロー

#### ① 削除ボタンクリック
- `window.confirm` で確認ダイアログを表示  
  ```
  会員ID xxx（会員番号 氏名（ニックネーム））を物理削除します。よろしいですか？
  ```
- キャンセル → 何もしない  
- OK → `checkMemberReferenced(memberId)` を実行  

#### ② 参照チェック
- `referenced: true`  
  - 「お知らせの作成者として参照されています。削除できません。」を画面に表示  
  - 削除しない  
- `referenced: false`  
  - `deleteMember(member.id)` を実行し、members から物理削除  

#### ③ 削除成功後
- `loadMembers()` を再実行し、一覧を更新  

#### ④ エラーハンドリング
- 参照チェックや削除でエラーが発生した場合  
  - エラーメッセージを画面上に表示  

---

### 2.3 データ構造
- `members` の構造は  
  `docs/specs/members/db_members_scheme.md` に準拠  
- 参照チェックは  
  `docs/specs/announcements/db_announcements_scheme.md` の `author_id` のみ使用  

---

## 3. テスト

### ● `admin/extra/page.test.tsx`
- `memberApi` をモック  
- `fetchMembers` が呼ばれること  
- 0 件時に「会員が0件です」と表示されること  
- 2 セクションの存在確認  
- 戻るリンクの存在確認  

---

### ● `memberApi.test.ts`
- `checkMemberReferenced` のテストを追加  
- `announcements` に `author_id` が無い場合 → `referenced: false`  
- `author_id` がある場合 →  
  - `referenced: true`  
  - メッセージが「お知らせの作成者として参照されています」  

---

## 4. 今後の拡張

### ● 他テーブル参照の追加
会員 ID を参照するテーブルが増えた場合は、  
`checkMemberReferenced` 内に以下のようなチェックを追加する：

```ts
supabase
  .from('テーブル名')
  .select()
  .eq('会員IDカラム', memberId)
  .limit(1)
```

- 1 件以上あれば  
  ```ts
  { referenced: true, message: '◯◯で参照されています。削除できません。' }
  ```
- これを積み重ねることで、参照整合性を担保できる  

---