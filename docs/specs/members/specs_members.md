# 会員管理仕様

## 1. 会員区分（Membership Type）

会員の「種類」を示す分類で、利用できる機能や優遇内容を決める基礎となる。

### ● 一般会員（general）
- 標準的な会員  
- メールアドレス必須  
- ログイン可能  

### ● プレミアム会員（premium）
- 優遇措置を受けられる会員  
- 抽選優先、先行予約、割引などの特典  
- メールアドレス必須  
- ログイン可能  

### ● ゲスト会員（guest）
- ホスト会員に紐づく非正規会員  
- メールアドレス任意  
- ログイン可能  
- 子どもやお試し参加者など  
- 将来一般会員へ昇格可能  

---

## 2. 会員ステータス（Status）

会員の「現在の状態」を示す属性。区分とは独立している。

### ● 基本ステータス
- **在籍（Active）**：活動中。ログイン可能  
- **休会（Suspended）**：活動停止中。ログイン可能だが機能制限あり  
- **退会（Withdrawn）**：アカウント無効化。ログイン不可  
  - 過去のイベント参加履歴や会計履歴は保持  

### ● 申請ステータス（承認制）
- **入会申請中（Registration request）**  
- **休会申請中（Suspend request）**  
- **退会申請中（Withdraw request）**  
- **拒否（Rejected）**  
  - 強制退会など  
  - ログイン不可  
  - 入会申請も不可  

### ● ゲスト会員の特性
- ゲストは「区分」であり「状態」ではない  
- ステータスは常に在籍扱い  
- 休会・退会の概念は持たない  

---

## 3. 権限（Role）

会員がシステム上でどこまで操作できるかを決める属性。  
会員区分・ステータスとは独立している。

### ● システム管理者（System administrator）
- 全機能にアクセス可能  
- 会員である必要はない  

### ● 役員（President / Vice-president / Manager）
- 必要な管理機能にアクセス可能  
- 会員区分とは無関係に設定可能  

#### 役員のルール
- **会長（President）**  
  - 副会長・担当者を指定／削除  
  - 会長交代時、旧会長は一般ユーザーへ  
- **副会長（Vice-president）**  
  - 担当者を指定／削除  
- **人数制約**  
  - 会長：1名  
  - 副会長・担当者：複数名可  
  - 副会長・担当者は最低1名必要  

### ● 一般ユーザー（Member）
- イベント参加・お知らせ閲覧などが可能  

---

## 4. 会員基本情報

すべての会員（一般・プレミアム・ゲスト）が共通で持つ情報。  
ただし必須項目は区分によって異なる。

### ● 基本情報
- 氏名（必須）  
- 氏名ローマ字（必須）  
- ニックネーム（必須、LINEユーザーは自動設定）  
- 会員番号（4桁ユニークID、システム自動設定）  
- メールアドレス（一般・プレミアム必須、ゲスト任意）  
- 電話番号（任意）  
- 郵便番号（任意）  
- 住所（任意）  
- 性別（任意）  
- 生年月日（任意）  
- 備考（公開情報）  
- 緊急連絡先（必須）  
- 緊急連絡先続柄（必須）  
- 緊急連絡メモ（非公開）  
- 入会日（自動設定）  
- DUPR ID  
- DUPR Rating  
- DUPR チェック日（自動入力）  

---

## 5. ニックネーム仕様（表示用）

- 自由に設定可能  
- LINEユーザーは displayName を自動反映  
- 重複時は自動で番号付加  
  - 例：Taro → Taro#2 → Taro#3  
- displayName 変更時は自動更新  
- ゲストの「ホスト名」表示も自動更新  

---

## 6. 会員番号（内部ID）

- 4桁のユニーク番号（0001〜9999）  
- 将来拡張可能  
- 絶対に変更されない本人識別子  
- ゲスト紹介時の「秘密キー」として使用  
- 全機能（イベント・会計・備品）で参照される基盤ID  

---

## 7. ゲスト会員の扱い

- 会員区分が「ゲスト」  
- メールアドレス任意  
- ログイン可能  
- ホスト会員に紐づく  
- 利用可能機能は制限  
- ホスト退会時はゲストも資格喪失  
- 将来一般会員へ昇格可能  

### ● ホスト指定方法
- ホストのニックネーム  
- ホストの会員番号（秘密キー）  
→ この2つの完全一致でホストを特定  

---

## 8. LINE連携仕様

- 初回アクセス時にメールアドレス入力を求める  
- 既存会員 → LINE ID を紐付け  
- 新規 → 会員登録へ遷移  
- 以後は自動ログイン  
- displayName をニックネームとして自動反映  
- LINE ID は内部で保持し、本人識別に使用  

# 会員管理機能ユースケース仕様

## 1. 新規登録・ログインまわり

### A-01：一般／プレミアム会員として新規登録する
- 氏名、ニックネーム、メールアドレス、パスワードなどを入力してアカウントを作成する。

### A-02：ゲスト会員として新規登録する
- 自分の情報を入力し、紹介者（ホスト）のニックネームと会員番号を指定して登録する。

### A-03：LINEでログインする
- LINEからアクセスし、自動的に会員情報に紐づいた状態でログインする。
- 初回アクセス時は会員登録を行う。

### A-04：メールアドレス＋パスワードでログインする
- ブラウザからログインする。

### A-05：パスワードをリセットする

---

## 2. 会員情報に関する操作

### A-11：自分のプロフィールを閲覧する
- 氏名、ニックネーム、会員番号、区分、ステータスなどを確認する。

### A-12：自分のプロフィールを編集する
#### 変更可能な情報
- メールアドレス  
- ニックネーム（LINEユーザはログイン時に自動更新）  
- パスワード  
- 電話番号（任意）  
- 郵便番号（任意）  
- 住所（任意）  
- 性別（任意）  
- 生年月日（任意）  
- 備考（他会員に公開）  
- 緊急連絡先（必須）  
- 緊急連絡先続柄（必須）  
- 緊急連絡メモ（非公開）  
- DUPR ID  
- DUPR Rating（Doubles, Singles）

#### 変更不可（権限者のみ変更可）
- 会員番号  
- 本名  
- 本名ローマ字  
- 性別  
- 生年月日  
- 会員種別  
- ステータス  
- 役割  
- 在籍年数（自動設定）  
- DUPR Rating取得日（自動設定）

### A-13：会員区分を変更する（一般 ↔ プレミアム）
- 初期バージョンでは実装しない。

### A-14：休会を申請する
- ゲストは申請不可。

### A-15：休会申請を取りやめる
- ゲストは対象外。

### A-16：退会を申請する
- 休会中でも退会申請可能。
- ゲストの場合 → 情報は物理削除。
- 一般会員の場合 → メールアドレスや LINE_ID に退会付加情報を追記して保持。

### A-17：退会申請を取りやめる

### A-18：他会員への公開可否を設定する
- 公開対象：ニックネーム、備考、DUPR ID、DUPR Rating  
- 非公開：緊急連絡メモなど

### A-19：他会員を検索し、公開設定に従って情報を表示する
- 検索キー：ニックネーム、メールアドレス  
- 見つからない場合：「メンバーが見つかりません」  
- 非公開会員の場合：「非公開会員です」

---

## 3. ゲスト関連の操作

### A-21：ホストを変更する
- 既存ゲストがホスト（紹介者）を別の会員に変更する。

### A-22：ゲストから一般会員への変更を申請する
- 初期バージョンでは実装しない（管理担当が区分変更で代替）。

---

## 4. 管理者・役員から見える操作（会員管理）

### A-31：会員一覧を閲覧する
- 区分・ステータス・権限などで絞り込み可能。

### A-32：特定の会員の詳細情報を閲覧する

### A-33：特定会員の情報を編集する
- 氏名、読み、会員区分など  
- LINE ID など外部取得情報は変更不可

### A-34：役員権限を付与・解除する

### A-35：各種申請（休会・退会・区分変更など）を承認または却下する
- 管理者または役員が申請内容を確認し、承認または却下する。

### A-36：強制退会させる
- ゲスト → 物理削除  
- 一般会員 → 拒否ステータスに変更（ログイン不可・再入会不可）

---

## プロフィール公開仕様

### ● 公開設定
- 公開対象：ニックネーム、備考、DUPR ID、DUPR Rating  
- 非公開：緊急連絡メモなど  
- LINEニックネームは公開対象（非公開設定不可）

### ● 検索時の挙動
- 見つからない場合：「メンバーが見つかりません」  
- 非公開会員の場合：「非公開会員です」  
