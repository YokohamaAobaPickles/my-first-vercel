# プロジェクト開発憲章（Development Charter）

本ドキュメントは、本プロジェクトにおける開発方針・品質基準・作業プロセスを定義する。  
すべての実装・修正・レビューは、この憲章に従って行う。

---

# 1. 開発フローの原則

## 1.1 ブランチ戦略
- 開発時は必ず専用ブランチを作成する。  
- `main` への直接コミットは禁止。  
- 破壊的変更を防ぎ、安定したリリースを維持する。

## 1.2 テストファースト（TDD）
- 本体コードより先にテストコードを作成する。  
- まず「意図した通りに失敗する」ことを確認する。  
- テストが仕様書の役割を果たす。

## 1.3 段階的検証フロー
1. Vitest でテストを実行し、期待通りに失敗することを確認  
2. 本体コードを実装  
3. Vitest で全テストが合格（オールグリーン）になることを確認  
4. Vercel 等にデプロイし、実機で最終確認  
5. 問題なければ `main` にマージ

## 1.4 マージ条件
- 自動テストがすべて成功していること  
- 実機確認が完了していること  
- 必要に応じてレビューを通過していること  

---

# 2. 修正プロセス（Cursor Pro 最適化版）

Cursor Pro の能力を最大限活かしつつ、暴走や意図しない大規模改変を防ぐためのプロセス。

## 2.1 修正方針の説明を AI に求める
実装前に必ず AI に以下を説明させる：
- どのファイルを変更するか  
- どのロジックに影響するか  
- 破壊的変更のリスクはあるか  
- 変更の意図と目的  

## 2.2 差分ベースでの修正
- AI は「変更が必要な箇所のみ」を提示する。  
- Git diff と同等の粒度で提示する。  
- 大規模な全体書き換えは禁止。

## 2.3 TDD の自動化
AI に以下の順で作業させる：
1. テストコードを作成  
2. テストが失敗することを確認  
3. 最小限の実装を作成  
4. テストが通るまで調整  

## 2.4 最新コードの提示は「必要なときだけ」
- 大規模修正や複雑なコンポーネント修正時のみ、ユーザーが最新コードを提示する。  
- 小規模修正は AI に任せても良い。

## 2.5 修正案の複数提示
- AI に「3つの修正アプローチ」を提案させる。  
- メリット・デメリットを比較し、最適案を選択する。

---

# 3. コード品質と共通化の原則

## 3.1 成功パターンの移植
- 既に安定して動作しているコンポーネント（例：プロフィール編集画面）を「正解」として扱う。  
- 設計、非同期処理、テストの書き方などを積極的に模倣・再利用する。

## 3.2 非同期処理の安定化
- React 19 の `use()` や Suspense 的挙動に対しては、Testing Library の `findBy*` 系メソッドなど、暗黙的待機を含む標準作法を使用する。  
- 不安定な `setTimeout` や過剰な `waitFor` は避ける。

## 3.3 コード書式の統一
- 1 行は 80 カラムでワードラップ  
- 並列の判定文（if など）は判定ごとに改行  
- HTML/CSS-in-JS のスタイル定義はプロパティごとに改行  

---

# 4. バージョン管理とドキュメントの原則

## 4.1 セマンティック・バージョニング（カスタム）
- **x (Major)**：大規模開発、実行環境の変更  
- **y (Minor)**：同一カテゴリ内での機能追加  
- **z (Patch)**：バグ修正、リファクタリング、機能変更なしの修正  

## 4.2 ファイルヘッダーの義務化
各ファイルの先頭に以下を記載する：

- Filename  
- Version  
- Update  
- Remarks（修正履歴）  

※ 言語に合わせたコメント形式で記述する。

## 4.3 ドキュメントの構造化
- `specs.md`：システム全体仕様  
- `development_guidelines.md`：本ドキュメント  
- `specs_members.md`：会員管理仕様  
- `specs_events.md`：イベント管理仕様  
- 必要に応じて細分化する  

---

# 5. AI（Cursor Pro）との協働原則

## 5.1 AI は「補助者」であり「自動生成機」ではない
- AI の提案は必ず人間が確認し、意図と一致しているか判断する。

## 5.2 AI に「理解 → 方針 → 差分 → 実装」の順で作業させる
- いきなりコードを書かせない。  
- 必ず「理解」と「方針説明」を先に行わせる。

## 5.3 AI に仕様書（specs）を参照させる
- 仕様に基づいたコード生成を徹底する。  
- 仕様と異なる提案があれば修正させる。

---

# 6. 最終目的

- **仕様に忠実で、破壊的変更がなく、テストで保証されたコードを継続的に生み出すこと。**  
- **AI と人間が協働し、品質と速度を両立する開発体制を構築すること。**

---